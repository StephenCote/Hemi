<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
	<head>
		<title>Hemi - JavaScript Framework</title>
		<link rel="stylesheet" href="/Styles/PageStyles2.css" type="text/css" title = "noauth" />
		<link id = "oAuthStyle" rel="alternate stylesheet" href="/Styles/PageStyles2Auth.css" type="text/css" title = "auth" />
		<link rel="stylesheet" href="/Hemi/Styles/hemi.css" type="text/css" />
		<script type = "text/javascript" src = "/Hemi/hemi.js"></script>
		<script type = "text/javascript" src = "/Scripts/PageScripts2.js"></script>
	</head>
	<body>

		<h1>Hemi - JavaScript Framework</h1>
		<h3>Canvas Test</h3>
		<ul class = "menu">
			<li class = "home"><a href = "/">Home</a></li>
			<li class = "hemi"><a href = "/Hemi">Hemi</a></li>
			<li class = "projects"><a href = "/projects/">Projects</a></li>
			<li class = "forum"><a href = "/Forum/">Forum</a></li>
			<li class = "documents"><a href = "/documents/">Documents</a></li>
			<li class = "contact"><a href = "#" component = "/Gizmos/component.window_control.xml" template = "/Templates/FeedbackForm.xml">Contact</a></li>
			<li class = "signup"><a href = "#" component = "/Gizmos/component.window_control.xml" template = "/Templates/SignupWizard1.xml">Signup</a></li>
			<li class = "infomercial"><a href = "#" component = "/Gizmos/component.window_control.xml" template = "/Templates/Infomercial.xml">Special Note</a></li>
			<li class = "login">
				<form action = "/Login.aspx" method = "post">
					<input type = "text" value = "" name = "UserName" /> 
					<input type = "password" value = "" name = "Password" />
					<input type = "hidden" value = "return" name = "direction" />
					<input type = "submit" value = "Login" />
				</form>
			</li>
			<li class = "session">
				<a component = "/Gizmos/component.window_control.xml" template = "/ActionForms/Profile.xml" class = "profile" title = "My Profile" href = "#">My Profile</a>
				<a component = "/Gizmos/component.window_control.xml" template = "/ActionForms/BlogAdmin.xml" class = "blog" href = "#">My Blog</a>
				<a component = "/Gizmos/component.window_control.xml" template = "/ActionForms/MediaAdmin.xml" class = "media" href = "#">My Media</a>
				<form action = "/Login.aspx?logout=1" method = "post">
					<input type = "hidden" value = "return" name = "direction" />
					<input type = "submit" value = "Logout" />
				</form>
			</li>
			<li class = "tools">
				<a component = "/Gizmos/component.window_control.xml" template = "Templates/FrameworkProfiler.xml" title = "Developer Tools" class = "tools" href = "#">Tools</a>
			</li>

		</ul>
        <p>
            <input type = "button" value = "Org" onclick = "DoOrg()" />
            <input type = "button" value = "JSON" onclick = "DoToJSON()" />
            <input type = "button" value = "Eval" onclick = "EvalHierarchy()" />
            <input type = "button" value = "Clear Hierarchy" onclick = "DoClearHierarchy()" />
            <input type = "text" id = "last_id" style ="width:25px;" value = "0" />
            <input type = "text" id = "node_name" value = "" />
            <input type = "button" value = "Add" onclick = "DoAdd()" />
            <input type = "button" value = "Render" onclick = "g_hierarchy.Render()" />
        </p>

        
        <div id = "oContainer"></div>
        <textarea id = "hierarchy_text" style = "width:100%;height:200px;"></textarea>
        <div module = "Console.Output"></div>
        <script type = "text/javascript">
         (function () {
             Hemi.include("hemi.app");
             Hemi.include("hemi.graphics.canvas");

             var oCanvas = Hemi.graphics.canvas.newInstance(document.getElementById("oContainer"));
             oCanvas.Resize(600, 400);

             //var oHD = Hemi.app.createApplicationComponent("hierarchy_decorator");
             var oH = Hemi.app.createApplicationComponent("hierarchy");
             //oH.getObjects().hierarchy_decorator = oHD;
             //alert(oHD.SetHierarchy + ":" + oHD.getReadyState());
             //oHD.SetHierarchy(oH);
             //oH.SetCanvasComponent(oCanvas);
             window.g_hierarchy = oH;
             window.g_canvas = oCanvas;

             var cfg = g_canvas.newContextConfig("DropShadow");
             cfg.fillStyle = '#0f0';
             cfg.strokeStyle = '#0f0';
             cfg.shadowColor = '#AAAAFF';
             cfg.shadowOffsetX = 5;
             cfg.shadowOffsetY = 5;
             cfg.shadowBlur = 1;

             g_canvas.setTemporaryContextConfig(cfg);


             var ctx = g_canvas.getTemporaryContext();
             //ctx.save();
             var cc = g_canvas.getContextConfig(g_canvas.getTemporaryContext());


             var g = g_canvas.getTemporaryContext().createLinearGradient(37, 25, 37, 50);
             /// rgba(255, 0, 0, 1)
             g.addColorStop(0, "#000000");
             g.addColorStop(0.4, '#CFCFCF');
             g.addColorStop(0.6, '#505050');
             g.addColorStop(1, '#000000');
             /*
             g.addColorStop(0, 'rgba(255, 0, 0, 1)');
             g.addColorStop(0.6, 'rgba(0, 255, 0, 0.5)');
             g.addColorStop(0.8, 'rgba(255, 255, 0, 0)');
             g.addColorStop(1, 'rgba(255, 0, 0, 1)');
             */
             /// ctx.fillStyle = g;
             var r1, r2;
             /*
             r1 = oCanvas.RoundedRect(25, 25, 50, 50, g, "#000000");
             r2 = oCanvas.RoundedRect(100, 100, 50, 50, g, "#000000");

             g_canvas.ConnectShapes(r1, r2);
             */
             r1 = oCanvas.RoundedRect(25, 175, 50, 50, g, "#000000");
             r2 = oCanvas.RoundedRect(100, 175, 50, 50, g, "#000000");
             
             g_canvas.ConnectShapes(r1, r2);


             //ctx.restore();
             //g_canvas.setTemporaryContextConfig("default");
             cfg.shadowOffsetX = 2;
             cfg.shadowOffsetY = 2;

             g_canvas.setTemporaryContextConfig(cfg);
             oCanvas.Text("Button", 25, 37, "#FFFFFF");
             ///oCanvas.ClearTempCanvas();
         } ());

function DoToJSON() {
   document.getElementById("hierarchy_text").value = g_hierarchy.NodeHierarchyToJSON();
}
function DoOrg()
{
   this.DoClear();
   g_hierarchy.Render();
}

function DoClearHierarchy()
{
   g_hierarchy.ClearHierarchy();
}

function LoadHierarchy(vNode, oParent)
{
   var oOrg = g_hierarchy.NewOrganizationNode(vNode.id,vNode.name,oParent);
   for(var i = 0; i < vNode.nodes.length; i++){
      this.LoadHierarchy(vNode.nodes[i],oOrg);
      }
}

function EvalHierarchy()
{
   this.DoClearHierarchy();
   var sVal = document.getElementById("hierarchy_text").value;
   var x;
   eval("x=" + sVal);
   if(x.Hierarchy) x = x.Hierarchy;
   for(var i = 0; i < x.length; i++){
      this.LoadHierarchy(x[i]);
  }
   g_hierarchy.Render();
}

function DoClear()
{
   this.GetComponentByRID("hierarchy").getObjects().canvas.Clear();
}

function DoAdd() {
   var sName = document.getElementById("node_name").value;
   if(!sName.length) sName = "Node";
   var iLastId = parseInt(document.getElementById("last_id").value);
   if(isNaN(iLastId)) iLastId = 0;
   var oP = 0;
   if(iLastId >= 0) oP = g_hierarchy.getObjects().nodes[iLastId];
   var oNode = g_hierarchy.NewOrganizationNode(++g_hierarchy.getProperties().node_counter, sName, oP);
   document.getElementById("last_id").value = oNode.index;
   g_hierarchy.Render();

}


        </script>
		
	</body>
</html>